![](https://img.shields.io/badge/-ceph-green)
# bitmap
* bitmap不是实际的数据类型，而是在 String 类型上定义的一组面向位的操作。由于字符串是二进制安全 blob，它们的最大长度为 512 MB，因此它们适合设置最多 2^32 个不同的位
* 位操作分为两组：恒定时间单个位操作，例如将位设置为 1 或 0，或获取其值，以及对位组的操作，例如计算给定位范围内设置位的数量（例如，人口计数）
* 位图的最大优势之一是它们在存储信息时通常可以极大地节省空间。例如，在不同用户由增量用户 ID 表示的系统中，仅使用 512 MB 内存就可以记住 40 亿用户的单个位信息（例如，知道用户是否想要接收新闻通讯）
***
* `SETBIT`and`GETBIT`命令设置和检索位
```
> setbit key 10 1
0
> getbit key 10
1
> getbit key 11
0
```
* 该`SETBIT`命令的第一个参数是位数，第二个参数是设置该位的值，即 1 或 0。如果寻址位超出当前字符串长度，该命令会自动放大字符串。
* `GETBIT`只返回指定索引处的位值。超出范围的位（寻址超出存储在目标键中的字符串长度的位）始终被视为零。
***
* `BITOP`在不同的字符串之间执行按位运算。提供的操作是 AND、OR、XOR 和 NOT
* `BITCOUNT`执行人口计数，报告设置为 1 的位数
* `BITPOS`查找具有指定值 0 或 1 的第一位
```
> setbit key 10 1
0
> getbit key 10
1
> getbit key 11
0
> bitcount key
1
```
***
位图的常见用例是：

各种实时分析。
存储与对象 ID 相关的空间高效但高性能的布尔信息。
例如，假设您想知道您的网站用户的最长每日访问次数。您从零开始计算天数，即您公开网站的日期，并在SETBIT每次用户访问该网站时设置一点。作为位索引，您只需获取当前的 unix 时间，减去初始偏移量，然后除以一天中的秒数（通常为 3600*24）。

这样，对于每个用户，您都有一个包含每天访问信息的小字符串。BITCOUNT可以轻松获取给定用户访问网站的天数，同时通过几次调用BITPOS，或者简单地获取和分析客户端的位图，可以轻松计算最长的连续性。

位图很容易拆分为多个键，例如为了对数据集进行分片，并且通常最好避免使用大键。要将位图拆分到不同的键上，而不是将所有位设置为一个键，一个简单的策略就是存储每个键的 M 位并获得键名bit-number/M和第 N 位以在键内寻址bit-number MOD M


